# 일일 시장 흐름 요약

시그널스는 매일 UTC 기준 하나의 비트코인 범위 시장을 실행합니다. 겉으로는 단순한 인터페이스이지만, 뒤에서는 운영자가 다음 시장을 준비하고 자동화가 불변식을 감시하며 서브그래프가 모든 이벤트를 비추는 일정한 리듬이 돌아갑니다. 아래 단계를 따라가면서 각 주체가 어떤 일을 맡고 어떤 데이터가 업데이트되는지 파악하세요.

## 거래가 열리기 전

UTC 오후에 운영 디스패처가 다음 날 시장을 위해 `createMarket`을 실행합니다. 이 트랜잭션은 결과 사양 `(L, U, s, d)`, 유동성 예산 $\alpha$, 거래 가능 시간대를 동시에 고정합니다. 실행과 동시에 세 가지 효과가 발생합니다. (1) 새로운 레이지 멀티플라이어 세그먼트 트리를 초기화해 CLMSR 잠재함수가 즉시 가격을 계산할 수 있게 합니다. (2) `MarketCreated` 이벤트가 발행되어 Goldsky 서브그래프와 앱이 다가오는 시장 카드를 미리 표시합니다. (3) 설정 내역이 배포 매니페스트에 기록되어 감사자가 어떤 범위가 공지됐는지 확인할 수 있습니다. 트레이더는 미리 차트, 틱 간격, 유동성을 검토하고, 통합 파트너는 연구나 재무 계획에 필요한 데이터를 아카이브합니다.

## 거래 구간 동안

`createMarket`이 포함된 블록부터 23:59:59(UTC)까지 모든 주문은 단일 CLMSR 잠재함수를 거칩니다. 각 범위는 동일한 지수 가중치 풀에서 가격을 산정하므로, 범위를 새로 열거나 늘리거나 회전하는 동작이 모두 하나의 트랜잭션으로 처리되며 그 비용은 시장 전체의 현재 상태를 반영합니다. 프런트엔드 구성 요소는 컨트랙트와 서브그래프를 나란히 조회합니다. 실시간 확률을 불러와 견적을 계산하고, `Position*` 이벤트를 소비해 리더보드와 활동 피드를 채우며, 유동성 변동이나 비정상적인 흐름이 감지되면 경고를 띄웁니다. 모니터링 스크립트가 불변식 위반, 오라클 지연, 비정상 가스 사용을 발견하면 운영자는 단 한 번의 호출로 거래를 일시 중지할 수 있고, 문제가 없다면 장은 계속 열려 있습니다.

## 장 마감

정확히 UTC 자정이 되면 UI가 “마감” 상태로 전환되어 신규 주문을 차단합니다. 운영자는 CoinMarketCap BTC/USD 일일 종가를 검증하고 설정된 틱 범위로 클램프한 값을 `settleMarket(marketId, value)`에 전달합니다. 이 호출은 온체인에 정규화된 정산 틱과 타임스탬프를 기록하고 `MarketSettled` 이벤트를 발행하며, 다음 단계 배치 처리를 위해 확률 곡선을 고정합니다. 아직 SUSD는 움직이지 않습니다. 이 단계는 결과만 확정하고 제어권을 배치 작업에 넘겨줍니다.

## 배치 정산

큰 시장에는 수천 개의 포지션이 존재할 수 있기 때문에 지급은 결정적인 배치를 통해 순차적으로 열립니다. 자동화 프로세스가 `emitPositionSettledBatch(limit)`를 호출하면서 포지션 목록의 일부를 순회하고, 컨트랙트가 `done = true`를 반환할 때까지 반복합니다. 각 반복마다 `PositionSettled`와 `PositionEventsProgress` 이벤트가 발행되어 처리된 구간이 드러나고 아직 대기 중인 포지션도 바로 파악할 수 있습니다. 배치는 멱등성을 가지므로 네트워크 문제로 재실행되더라도 중복 처리되지 않습니다. 서브그래프는 남겨진 브레드크럼을 모두 인덱싱해 탐색기와 분석 도구가 블록 단위로 진행 상황을 재현할 수 있게 합니다.

## 정산 이후

마지막 배치가 승인되면 승리한 포지션은 언제든 청구할 수 있습니다. 트레이더는 `claimPayout`을 호출해 스테이크와 수익을 동시에 수령하고, 포지션 NFT는 같은 트랜잭션에서 소각됩니다. 리스크 관리 부서와 커뮤니티 팀 역시 동일한 이벤트를 활용해 대시보드를 갱신하고 잔고를 조정하며 야간 리포트를 발행합니다. 한편 디스패처는 다음 날 시장을 이미 준비해 두는 경우가 많아 루프가 끊김 없이 다시 시작됩니다.

## 역할 한눈에 보기

- **운영팀**은 시장을 구성하고 오라클 종가를 검증하며 배치 스크립트를 정상 상태로 유지합니다. 이들의 트랜잭션은 매니페스트와 탐색기 링크를 통해 모두 감사 가능합니다.
- **자동화**는 리듬을 강제합니다. 불변식을 감시하고, 배치 실행을 재시도하며, `done = true`가 나타나지 않을 때 경보를 보냅니다.
- **트레이더와 통합 파트너**는 앱 또는 서브그래프를 소비하며 거래하고, 나중에 페이아웃을 청구하며, 많은 팀이 데이터를 자체 연구 노트북으로 미러링합니다.

사용자와 운영자 행동을 분 단위로 살펴보고 싶다면 [시그널스 작동 방식](./how-it-works.md)을, 배치 정산 구현은 [정산 파이프라인](../market/settlement-pipeline.md)에서 확인하세요. 직접 범위를 배치할 준비라면 [빠른 시작 가이드](../quickstart/index.md)와 [트레이더 가이드](../user/positions-lifecycle.md)를 참고하세요.
